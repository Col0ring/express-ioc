# express-ioc

一个极简的仿照 nest.js 的框架。

## 完成功能

- [x] 依赖注入与 IOC 容器
- [x] Injectable 与 Inject 装饰器以及内部的依赖引用
- [x] 错误拦截装饰器
- [x] 请求方法装饰器
- [x] 中间件装饰器
- [x] 管道装饰器
- [x] 自动引入控制器
- [x] 自定义统一异常信息
- [x] 简化响应数据，可使用`return`或自行`res.send()`响应数据
- [x] 数据库
- [x] 日志
- [x] 文件上传
- [x] 参数校验（使用管道）
- [x] 鉴权

## 使用

### 添加控制器

直接在`src/modules/**/*.controller.ts`目录中添加控制器，或者自行在`controllerConfig`中进行定义，控制器是由`@Controller`装饰器修饰的类。

**注意：** 当有多个装饰器存在时，因为装饰器的执行顺序的缘故，应该将`@Controller`放在最顶部，否则可能会有未知错误。

### 依赖注入

使用`@Injectable`对类进行修饰或者使用`@Inject`对需要被注入的属性进行修饰（注意：`@Inject`装饰器只能用于构造函数的参数中）。

### 异常处理

在`src/exceptions`添加相应的异常类，直接在程序中通过抛出异常的方式进行响应（包括成功的响应也可以通过抛出异常的方式统一请求格式），如果需要对响应的对象定制化自行修改`core/decorators/Exception.ts`中的代码。

### 获取指定请求参数

默认控制器中的函数不会有任何实参传入，如果需要指定请求参数，需要使用`core`中提供的对应参数的装饰器，或者直接使用`@Req`或`@Res`装饰器获取。

### 处理请求数据

在`src/pipes`中可以添加相应的管道，管道必须实现`PipeTransform`接口，该接口有一个`transform`方法，第一个参数为接收到的`value`值（如果使用多个管道会依次运行），返回的值为运行管道后的值。可以在这里直接抛出异常进行报错。

### DTO 校验

管道中`transform`方法的第二个参数是一个对象，下面有一个`metatype`属性，该属性是绑定值的类型，可以通过该属性完成 DTO 校验，项目中已经提供了对应的校验管道`validator.pipe.ts`，可根据条件进行修改。

## 注意

开发模式和生产模式有区别，在`build`后，需要注意根据`__DEV__`把相关自动引入代码的`ts`修改为`js`
